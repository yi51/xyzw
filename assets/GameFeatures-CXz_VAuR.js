import{d as ne,c as _,o as g,a as e,e as ce,u as ue,r as B,z as M,g as de,A as ee,F as ie,s as pe,n as J,x,i as Se,v as K,k as re,b as xe,B as Ce,m as F,j as k,w as D,l as L,t as ve,C as Ie,D as ye,E as Te,G as Me,q as De}from"./index-Bax7E3Q1.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as Be,_ as Ue,u as ze}from"./deviceDetector-IQv8hI74.js";const We={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=e("path",{d:"M480 128a64 64 0 0 0-64-64h-16V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 368 48v16H144V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 112 48v16H96a64 64 0 0 0-64 64v12a4 4 0 0 0 4 4h440a4 4 0 0 0 4-4z",fill:"currentColor"},null,-1),Ee=e("path",{d:"M32 416a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V179a3 3 0 0 0-3-3H35a3 3 0 0 0-3 3zm344-208a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24z",fill:"currentColor"},null,-1),Ae=[Oe,Ee],He=ne({name:"Calendar",render:function(a,i){return g(),_("svg",We,Ae)}}),Ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Re=e("path",{d:"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208s208-93.31 208-208S370.69 48 256 48zm108.25 138.29l-134.4 160a16 16 0 0 1-12 5.71h-.27a16 16 0 0 1-11.89-5.3l-57.6-64a16 16 0 1 1 23.78-21.4l45.29 50.32l122.59-145.91a16 16 0 0 1 24.5 20.58z",fill:"currentColor"},null,-1),Pe=[Re],Ve=ne({name:"CheckmarkCircle",render:function(a,i){return g(),_("svg",Ne,Pe)}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ge=e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1),je=[Ge],qe=ne({name:"ChevronDown",render:function(a,i){return g(),_("svg",Le,je)}}),Je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Qe=e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 328l144-144l144 144"},null,-1),Xe=[Qe],Ye=ne({name:"ChevronUp",render:function(a,i){return g(),_("svg",Je,Xe)}}),Ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ze=e("path",{d:"M424.44 227.25a16 16 0 0 1-12.12-12.39c-7.68-36.68-24.45-68.15-49.18-92A153.57 153.57 0 0 0 256 80c-35.5 0-68.24 11.69-94.68 33.8a156.24 156.24 0 0 0-42 56a16 16 0 0 1-11.37 9.15c-27 5.62-51.07 17.34-69.18 33.87C13.39 235.88 0 267.42 0 304c0 36 14.38 68.88 40.49 92.59C65.64 419.43 99.56 432 136 432h260c32.37 0 60.23-8.57 80.59-24.77C499.76 388.78 512 361.39 512 328c0-57.57-42-90.58-87.56-100.75zm-95.2-8.94l-107.8 128a16 16 0 0 1-12 5.69h-.27a16 16 0 0 1-11.88-5.28l-45.9-50.87c-5.77-6.39-5.82-16.33.3-22.4a16 16 0 0 1 23.16.63l33.9 37.58l96-114a16 16 0 1 1 24.48 20.62z",fill:"currentColor"},null,-1),Fe=[Ze],et=ne({name:"CloudDone",render:function(a,i){return g(),_("svg",Ke,Fe)}}),tt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},st=e("path",{d:"M428 224H288a48 48 0 0 1-48-48V36a4 4 0 0 0-4-4h-92a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h224a64 64 0 0 0 64-64V228a4 4 0 0 0-4-4zm-92 160H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32zm0-80H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),nt=e("path",{d:"M419.22 188.59L275.41 44.78a2 2 0 0 0-3.41 1.41V176a16 16 0 0 0 16 16h129.81a2 2 0 0 0 1.41-3.41z",fill:"currentColor"},null,-1),at=[st,nt],ot=ne({name:"DocumentText",render:function(a,i){return g(),_("svg",tt,at)}}),lt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},it=e("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),rt=[it],ct=ne({name:"EllipseOutline",render:function(a,i){return g(),_("svg",lt,rt)}}),ut={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},dt=e("circle",{cx:"256",cy:"256",r:"48",fill:"currentColor"},null,-1),mt=e("path",{d:"M470.39 300l-.47-.38l-31.56-24.75a16.11 16.11 0 0 1-6.1-13.33v-11.56a16 16 0 0 1 6.11-13.22L469.92 212l.47-.38a26.68 26.68 0 0 0 5.9-34.06l-42.71-73.9a1.59 1.59 0 0 1-.13-.22A26.86 26.86 0 0 0 401 92.14l-.35.13l-37.1 14.93a15.94 15.94 0 0 1-14.47-1.29q-4.92-3.1-10-5.86a15.94 15.94 0 0 1-8.19-11.82l-5.59-39.59l-.12-.72A27.22 27.22 0 0 0 298.76 26h-85.52a26.92 26.92 0 0 0-26.45 22.39l-.09.56l-5.57 39.67a16 16 0 0 1-8.13 11.82a175.21 175.21 0 0 0-10 5.82a15.92 15.92 0 0 1-14.43 1.27l-37.13-15l-.35-.14a26.87 26.87 0 0 0-32.48 11.34l-.13.22l-42.77 73.95a26.71 26.71 0 0 0 5.9 34.1l.47.38l31.56 24.75a16.11 16.11 0 0 1 6.1 13.33v11.56a16 16 0 0 1-6.11 13.22L42.08 300l-.47.38a26.68 26.68 0 0 0-5.9 34.06l42.71 73.9a1.59 1.59 0 0 1 .13.22a26.86 26.86 0 0 0 32.45 11.3l.35-.13l37.07-14.93a15.94 15.94 0 0 1 14.47 1.29q4.92 3.11 10 5.86a15.94 15.94 0 0 1 8.19 11.82l5.56 39.59l.12.72A27.22 27.22 0 0 0 213.24 486h85.52a26.92 26.92 0 0 0 26.45-22.39l.09-.56l5.57-39.67a16 16 0 0 1 8.18-11.82c3.42-1.84 6.76-3.79 10-5.82a15.92 15.92 0 0 1 14.43-1.27l37.13 14.95l.35.14a26.85 26.85 0 0 0 32.48-11.34a2.53 2.53 0 0 1 .13-.22l42.71-73.89a26.7 26.7 0 0 0-5.89-34.11zm-134.48-40.24a80 80 0 1 1-83.66-83.67a80.21 80.21 0 0 1 83.66 83.67z",fill:"currentColor"},null,-1),pt=[dt,mt],ke=ne({name:"Settings",render:function(a,i){return g(),_("svg",ut,pt)}}),vt="/icons/173746572831736.png",gt="/icons/174061875626614.png",be="/icons/1733492491706148.png",ft="/icons/1736425783912140.png",_t="/icons/Ob7pyorzmHiJcbab2c25af264d0758b527bc1b61cc3b.png",ht={class:"team-status-card"},yt={class:"card-header"},kt={class:"team-selector"},wt=["disabled","onClick"],Tt=["disabled"],bt={class:"card-content"},$t={class:"team-display"},St={class:"current-team-info"},xt={class:"team-number"},Ct={class:"heroes-container"},It={key:0,class:"heroes-inline"},Mt={class:"hero-circle"},Dt=["src","alt"],Bt={key:1,class:"hero-placeholder"},Ut={class:"hero-name"},zt={key:1,class:"empty-team"},Wt={key:2,class:"empty-team"},Ot=ne({__name:"TeamStatus",setup(Q){const a={101:{name:"司马懿",type:"魏国"},102:{name:"郭嘉",type:"魏国"},103:{name:"关羽",type:"蜀国"},104:{name:"诸葛亮",type:"蜀国"},105:{name:"周瑜",type:"吴国"},106:{name:"太史慈",type:"吴国"},107:{name:"吕布",type:"群雄"},108:{name:"华佗",type:"群雄"},109:{name:"甄姬",type:"魏国"},110:{name:"黄月英",type:"蜀国"},111:{name:"孙策",type:"吴国"},112:{name:"贾诩",type:"群雄"},113:{name:"曹仁",type:"魏国"},114:{name:"姜维",type:"蜀国"},115:{name:"孙坚",type:"吴国"},116:{name:"公孙瓒",type:"群雄"},117:{name:"典韦",type:"魏国"},118:{name:"赵云",type:"蜀国"},119:{name:"大乔",type:"吴国"},120:{name:"张角",type:"群雄"},201:{name:"徐晃",type:"魏国"},202:{name:"荀彧",type:"魏国"},203:{name:"典韦",type:"魏国"},204:{name:"张飞",type:"蜀国"},205:{name:"赵云",type:"蜀国"},206:{name:"庞统",type:"蜀国"},207:{name:"鲁肃",type:"吴国"},208:{name:"陆逊",type:"吴国"},209:{name:"甘宁",type:"吴国"},210:{name:"貂蝉",type:"群雄"},211:{name:"董卓",type:"群雄"},212:{name:"张角",type:"群雄"},213:{name:"张辽",type:"魏国"},214:{name:"夏侯惇",type:"魏国"},215:{name:"许褚",type:"魏国"},216:{name:"夏侯渊",type:"魏国"},217:{name:"魏延",type:"蜀国"},218:{name:"黄忠",type:"蜀国"},219:{name:"马超",type:"蜀国"},220:{name:"马岱",type:"蜀国"},221:{name:"吕蒙",type:"吴国"},222:{name:"黄盖",type:"吴国"},223:{name:"蔡文姬",type:"魏国"},224:{name:"小乔",type:"吴国"},225:{name:"袁绍",type:"群雄"},226:{name:"华雄",type:"群雄"},227:{name:"颜良",type:"群雄"},228:{name:"文丑",type:"群雄"},301:{name:"周泰",type:"吴国"},302:{name:"许攸",type:"魏国"},303:{name:"于禁",type:"魏国"},304:{name:"张星彩",type:"蜀国"},305:{name:"关银屏",type:"蜀国"},306:{name:"关平",type:"蜀国"},307:{name:"程普",type:"吴国"},308:{name:"张昭",type:"吴国"},309:{name:"陆绩",type:"吴国"},310:{name:"吕玲绮",type:"群雄"},311:{name:"潘凤",type:"群雄"},312:{name:"邢道荣",type:"群雄"},313:{name:"祝融夫人",type:"群雄"},314:{name:"孟获",type:"群雄"}},i=ce(),r=ue(),o=B(!1),A=B(!1),$=B(1),S=B([1,2,3,4]),f=M(()=>i.selectedToken?i.getWebSocketStatus(i.selectedToken.id):"disconnected"),z=M(()=>{var s;return((s=i.gameData)==null?void 0:s.presetTeam)??null});function Y(s){var ae;if(!s)return{useTeamId:1,teams:{}};const n=s.presetTeamInfo??s,d=q=>{if(!q||typeof q!="object")return null;if(typeof q.useTeamId=="number")return q.useTeamId;for(const te of Object.keys(q)){const j=d(q[te]);if(j)return j}return null},m=n.useTeamId??((ae=n.presetTeamInfo)==null?void 0:ae.useTeamId)??d(n)??1,y=n.presetTeamInfo??n,I={},N=Object.keys(y||{}).filter(q=>/^\d+$/.test(q));for(const q of N){const te=Number(q),j=y[q];if(!j){I[te]={teamInfo:{}};continue}if(j.teamInfo)I[te]={teamInfo:j.teamInfo};else if(j.heroes){const oe={};j.heroes.forEach((le,c)=>{oe[String(c+1)]=le}),I[te]={teamInfo:oe}}else if(typeof j=="object"){const oe=Object.values(j).some(le=>le&&typeof le=="object"&&"heroId"in le);I[te]={teamInfo:oe?j:{}}}else I[te]={teamInfo:{}}}return{useTeamId:Number(m)||1,teams:I}}const W=M(()=>Y(z.value)),G=M(()=>{var d;const s=(d=W.value.teams[$.value])==null?void 0:d.teamInfo;if(!s)return[];const n=[];for(const[m,y]of Object.entries(s)){const I=(y==null?void 0:y.heroId)??(y==null?void 0:y.id);if(!I)continue;const N=a[Number(I)];n.push({id:Number(I),name:(N==null?void 0:N.name)??`英雄${I}`,type:(N==null?void 0:N.type)??"",position:Number(m),level:(y==null?void 0:y.level)??1,avatar:y==null?void 0:y.avatar})}return n.sort((m,y)=>m.position-y.position),n}),h=async(s,n,d={},m="",y=8e3)=>{try{return await i.sendMessageWithPromise(s,n,d,y)}catch(I){const N=(I==null?void 0:I.message)??String(I);throw m&&r.error(`${m}失败：${N}`),I}},T=async(s=!1)=>{var d,m;if(!i.selectedToken)return r.warning("请先选择Token"),null;const n=i.selectedToken.id;if(!s){const y=(m=(d=i.gameData)==null?void 0:d.presetTeam)==null?void 0:m.presetTeamInfo;if(y)return y}o.value=!0;try{const y=await h(n,"presetteam_getinfo",{},"获取阵容信息");return i.$patch(I=>{I.gameData={...I.gameData??{},presetTeam:y}}),(y==null?void 0:y.presetTeamInfo)??null}catch(y){return console.error("获取阵容信息失败:",y),null}finally{o.value=!1}},C=()=>{const s=Object.keys(W.value.teams).map(Number).filter(n=>!Number.isNaN(n)).sort((n,d)=>n-d);S.value=s.length?s:[1,2,3,4]},O=()=>{$.value=W.value.useTeamId||1},P=async s=>{if(A.value||o.value)return;if(!i.selectedToken){r.warning("请先选择Token");return}const n=$.value;A.value=!0;try{await h(i.selectedToken.id,"presetteam_saveteam",{teamId:s},`切换到阵容 ${s}`),$.value=s,r.success(`已切换到阵容 ${s}`),await l(!0)}catch{$.value=n}finally{A.value=!1}},l=async(s=!1)=>{await T(s)};return de(async()=>{i.selectedToken&&f.value==="connected"?(await l(!1),C(),O(),z.value||(await l(!0),C(),O())):i.selectedToken?console.log("🛡️ WebSocket未连接，等待连接后自动获取队伍信息"):console.log("🛡️ 没有选中的Token，无法获取队伍信息")}),ee(f,(s,n)=>{console.log(`🛡️ WebSocket状态变化: ${n} -> ${s}`),s==="connected"&&n!=="connected"&&i.selectedToken&&(console.log("🛡️ WebSocket已连接，自动获取队伍信息"),setTimeout(async()=>{await l(!1),C(),O(),z.value||(await l(!0),C(),O())},1e3))}),ee(()=>i.selectedToken,async(s,n)=>{s&&s.id!==(n==null?void 0:n.id)&&(console.log("🛡️ Token已切换，重新获取队伍信息"),i.getWebSocketStatus(s.id)==="connected"&&(await l(!0),C(),O()))}),ee(()=>z.value,()=>{C(),O()},{deep:!0}),(s,n)=>(g(),_("div",ht,[e("div",yt,[n[2]||(n[2]=e("img",{src:_t,alt:"队伍图标",class:"team-icon"},null,-1)),n[3]||(n[3]=e("div",{class:"team-info"},[e("h3",null,"队伍阵容"),e("p",null,"当前使用的战斗阵容")],-1)),e("div",kt,[(g(!0),_(ie,null,pe(S.value,d=>(g(),_("button",{key:d,disabled:o.value||A.value,class:J(["team-button",{active:$.value===d}]),onClick:m=>P(d)},x(d),11,wt))),128)),e("button",{class:"refresh-button",disabled:o.value,title:"刷新队伍数据",onClick:n[0]||(n[0]=d=>l(!0))},n[1]||(n[1]=[Se('<svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-43018590><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-43018590></path><path d="M21 3v5h-5" data-v-43018590></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-43018590></path><path d="M3 21v-5h5" data-v-43018590></path></svg><span class="refresh-text" data-v-43018590>刷新</span>',2)]),8,Tt)])]),e("div",bt,[e("div",$t,[e("div",St,[n[4]||(n[4]=e("span",{class:"label"},"当前阵容",-1)),e("span",xt,[o.value?(g(),_(ie,{key:1},[K("加载中…")],64)):(g(),_(ie,{key:0},[K("阵容 "+x($.value),1)],64))])]),e("div",Ct,[o.value?re("",!0):(g(),_("div",It,[(g(!0),_(ie,null,pe(G.value,d=>{var m;return g(),_("div",{key:d.id||d.name,class:"hero-item"},[e("div",Mt,[d.avatar?(g(),_("img",{key:0,src:d.avatar,alt:d.name,class:"hero-avatar"},null,8,Dt)):(g(),_("div",Bt,x(((m=d.name)==null?void 0:m.substring(0,2))||"?"),1))]),e("span",Ut,x(d.name||"未知"),1)])}),128))])),!o.value&&!G.value.length?(g(),_("div",zt,n[5]||(n[5]=[e("p",null,"暂无队伍信息",-1)]))):re("",!0),o.value?(g(),_("div",Wt,n[6]||(n[6]=[e("p",null,"正在加载队伍信息…",-1)]))):re("",!0)])])])]))}}),Et=me(Ot,[["__scopeId","data-v-43018590"]]),At="/icons/174023274867420.png",Ht={class:"daily-task-container"},Nt={class:"task-header"},Rt={class:"header-right"},Pt={class:"progress-container"},Vt=["disabled"],Lt={key:0,class:"loading-text"},Gt={key:1},jt={key:2},qt={class:"modal-header"},Jt={class:"settings-content"},Qt={class:"settings-grid"},Xt={class:"setting-item"},Yt={class:"setting-item"},Kt={class:"setting-item"},Zt={class:"setting-switches"},Ft={class:"switch-row"},es={class:"switch-row"},ts={class:"switch-row"},ss={class:"switch-row"},ns={class:"switch-row"},as={class:"switch-row"},os={class:"switch-row"},ls={class:"modal-header"},is=["disabled"],rs={class:"task-list"},cs={class:"task-item-left"},us={class:"task-name"},ds={class:"modal-header"},ms={class:"log-time"},we=500,ps={__name:"DailyTaskStatus",setup(Q){const a=ce(),i=ue(),r=B(!1),o=B(!1),A=B(!1),$=B(!1),S=B(null),f=xe({arenaFormation:1,bossFormation:1,bossTimes:4,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),z=B([{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品（请设置采购清单）",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}]),Y=[1,2,3,4].map(c=>({label:`阵容${c}`,value:c})),W=[0,1,2,3,4].map(c=>({label:`${c}次`,value:c})),G=M(()=>a.selectedTokenRoleInfo),h=M(()=>{var c,t,w;return((w=(t=(c=G.value)==null?void 0:c.role)==null?void 0:t.dailyTask)==null?void 0:w.dailyPoint)??0}),T=M(()=>Math.min(h.value,100)),C=M(()=>T.value>=100),O=M(()=>C.value?"#10b981":"#3b82f6"),P=M(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id)==="connected":!1),l=B([]),s=(c,t="info")=>{const w=new Date().toLocaleTimeString();l.value.push({time:w,message:c,type:t}),l.value.length>we&&l.value.splice(0,l.value.length-we),Ie(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})},n=c=>{var U,E;if(!((E=(U=c==null?void 0:c.role)==null?void 0:U.dailyTask)!=null&&E.complete)){s("角色信息中无任务完成数据","warning");return}const t=c.role.dailyTask.complete,w=H=>H===-1;s("开始同步任务完成状态..."),s(`服务器返回的任务完成数据: ${JSON.stringify(t)}`);let p=0,R=0;z.value.forEach(H=>{H.completed=!1}),Object.keys(t).forEach(H=>{const u=Number(H),b=z.value.findIndex(se=>se.id===u);if(b>=0){const se=w(t[H]);z.value[b].completed=se,p++,se&&R++,s(`任务${u} "${z.value[b].name}": ${se?"已完成":"未完成"}`,se?"success":"info")}else s(`服务器返回未知任务ID: ${u} (完成值: ${t[H]})`,"warning")}),s(`任务状态同步完成: ${R}/${p} 已完成`),s(`当前进度: ${h.value}/100`)},d=async()=>{if(!a.selectedToken)throw new Error("没有选中的Token");const c=a.selectedToken.id;s("正在获取角色信息...");try{const t=await a.sendGetRoleInfo(c);return s("角色信息获取成功","success"),t&&n(t),t}catch(t){throw s(`获取角色信息失败: ${t.message}`,"error"),t}},m=async(c,t,w={},p="",R=8e3)=>{try{p&&s(`执行: ${p}`);const U=await a.sendMessageWithPromise(c,t,w,R);return p&&s(`${p} - 成功`,"success"),U}catch(U){throw p&&s(`${p} - 失败: ${U.message}`,"error"),U}},y=c=>{if(!c)return!0;const t=new Date().toDateString(),w=new Date(c).toDateString();return t!==w},I=()=>{const c=[9904,9905,9901,9902,9903,9904,9905],t=new Date().getDay();return c[t]},N=async(c,t,w,p)=>{var R,U,E;try{const H=(U=(R=a.gameData)==null?void 0:R.presetTeam)==null?void 0:U.presetTeamInfo;let u=H==null?void 0:H.useTeamId;if(u)p(`从缓存获取当前阵容: ${u}`);else{p("缓存中无阵容信息，从服务器获取...");const b=await m(c,"presetteam_getinfo",{},"获取阵容信息");u=(E=b==null?void 0:b.presetTeamInfo)==null?void 0:E.useTeamId,p(`从服务器获取当前阵容: ${u}`)}return u===t?(p(`当前已是${w}${t}，无需切换`,"success"),!1):(p(`当前阵容: ${u}, 目标阵容: ${t}，开始切换...`),await m(c,"presetteam_saveteam",{teamId:t},`切换到${w}${t}`),p(`成功切换到${w}${t}`,"success"),!0)}catch(H){p(`阵容检查失败，直接切换: ${H.message}`,"warning");try{return await m(c,"presetteam_saveteam",{teamId:t},`强制切换到${w}${t}`),!0}catch(u){throw p(`强制切换也失败: ${u.message}`,"error"),u}}},ae=async(c,t,w)=>{var _e;const p=a.selectedToken.id,R=c==null?void 0:c.role;if(!R)throw new Error("角色数据不存在");t("开始执行每日任务补差");const U=((_e=R.dailyTask)==null?void 0:_e.complete)??{},E=v=>U[v]===-1,H=R.statistics??{},u=R.statisticsTime??{},b=[];if(E(2)||b.push({name:"分享一次游戏",execute:()=>m(p,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),E(3)||b.push({name:"赠送好友金币",execute:()=>m(p,"friend_batch",{},"赠送好友金币")}),E(4)||(b.push({name:"免费招募",execute:()=>m(p,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),f.payRecruit&&b.push({name:"付费招募",execute:()=>m(p,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!E(6)&&y(u["buy:gold"]))for(let v=0;v<3;v++)b.push({name:`免费点金 ${v+1}/3`,execute:()=>m(p,"system_buygold",{buyNum:1},`免费点金 ${v+1}`)});if(!E(5)&&f.claimHangUp){for(let v=0;v<4;v++)b.push({name:`挂机加钟 ${v+1}/4`,execute:()=>m(p,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${v+1}`)});b.push({name:"领取挂机奖励",execute:()=>m(p,"system_claimhangupreward",{},"领取挂机奖励")}),b.push({name:"挂机加钟 5/5",execute:()=>m(p,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(!E(7)&&f.openBox&&b.push({name:"开启木质宝箱",execute:()=>m(p,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),!E(14)&&f.claimBottle&&b.push({name:"领取盐罐奖励",execute:()=>m(p,"bottlehelper_claim",{},"领取盐罐奖励")}),!E(13)&&f.arenaEnable&&b.push({name:"竞技场战斗",execute:async()=>{var v,Z;t("开始竞技场战斗流程"),await N(p,f.arenaFormation,"竞技场阵容",t),await m(p,"arena_startarea",{},"开始竞技场");for(let X=1;X<=3;X++){t(`竞技场战斗 ${X}/3`);const V=await m(p,"arena_getareatarget",{refresh:!1},`获取竞技场目标${X}`),he=(Z=(v=V==null?void 0:V.roleList)==null?void 0:v[0])==null?void 0:Z.roleId;he?await m(p,"fight_startareaarena",{targetId:he},`竞技场战斗${X}`,1e4):t(`竞技场战斗${X} - 未找到目标`,"warning"),await new Promise($e=>setTimeout($e,1e3))}}}),f.bossTimes>0){const v=H["legion:boss"]??0,Z=Math.max(f.bossTimes-v,0);if(Z>0){b.push({name:"军团BOSS阵容检查",execute:()=>N(p,f.bossFormation,"BOSS阵容",t)});for(let V=0;V<Z;V++)b.push({name:`军团BOSS ${V+1}/${Z}`,execute:()=>m(p,"fight_startlegionboss",{},`军团BOSS ${V+1}`,12e3)})}const X=I();Z===0&&b.push({name:"每日BOSS阵容检查",execute:()=>N(p,f.bossFormation,"BOSS阵容",t)});for(let V=0;V<3;V++)b.push({name:`每日BOSS ${V+1}/3`,execute:()=>m(p,"fight_startboss",{bossId:X},`每日BOSS ${V+1}`,12e3)})}const se=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部签到",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取免费礼包",cmd:"card_claimreward"},{name:"领取永久卡礼包",cmd:"card_claimreward",params:{cardId:4003}}];if(f.claimEmail&&se.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),se.forEach(v=>{b.push({name:v.name,execute:()=>m(p,v.cmd,v.params||{},v.name)})}),y(u["artifact:normal:lottery:time"]))for(let v=0;v<3;v++)b.push({name:`免费钓鱼 ${v+1}/3`,execute:()=>m(p,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${v+1}`)});const ge=["魏国","蜀国","吴国","群雄"];for(let v=1;v<=4;v++)y(u[`genie:daily:free:${v}`])&&b.push({name:`${ge[v-1]}灯神免费扫荡`,execute:()=>m(p,"genie_sweep",{genieId:v},`${ge[v-1]}灯神免费扫荡`)});for(let v=0;v<3;v++)b.push({name:`领取免费扫荡卷 ${v+1}/3`,execute:()=>m(p,"genie_buysweep",{},`领取免费扫荡卷 ${v+1}`)});!E(12)&&f.blackMarketPurchase&&b.push({name:"黑市购买1次物品",execute:()=>m(p,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let v=1;v<=10;v++)b.push({name:`领取任务奖励${v}`,execute:()=>m(p,"task_claimdailypoint",{taskId:v},`领取任务奖励${v}`,5e3)});b.push({name:"领取日常任务奖励",execute:()=>m(p,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>m(p,"task_claimweekreward",{},"领取周常任务奖励")});const fe=b.length;t(`共有 ${fe} 个任务待执行`);for(let v=0;v<b.length;v++){const Z=b[v];try{await Z.execute();const X=Math.floor((v+1)/fe*100);w&&w(p,X),await new Promise(V=>setTimeout(V,500))}catch(X){t(`任务执行失败: ${Z.name} - ${X.message}`,"error")}}w&&w(p,100),t("所有任务执行完成","success"),await new Promise(v=>setTimeout(v,2e3)),await d()},q=async()=>{var c;if(!a.selectedToken||$.value){i.warning("没有选中Token或正在执行中");return}if(!P.value){i.error("WebSocket连接未建立，请检查连接状态");return}$.value=!0,A.value=!0,l.value=[];try{s("=== 开始执行一键补差任务 ===");const t=await d();if(!(t!=null&&t.role))throw new Error("获取角色信息失败或数据异常");s(`当前每日任务进度: ${((c=t.role.dailyTask)==null?void 0:c.dailyPoint)||0}/100`),s("第二步: 开始执行每日任务..."),await ae(t,s,(w,p)=>{s(`任务进度: ${p}%`)}),s("=== 任务执行完成 ===","success"),i.success("每日任务补差执行完成"),setTimeout(async()=>{try{await d(),s("最终角色信息刷新完成","success")}catch(w){s(`最终刷新失败: ${w.message}`,"warning")}},3e3)}catch(t){s(`任务执行失败: ${t.message}`,"error"),console.error("详细错误信息:",t),i.error(`任务执行失败: ${t.message}`)}finally{$.value=!1}},te=async()=>{if(!P.value){i.warning("WebSocket未连接，无法刷新任务状态");return}try{s("手动刷新任务状态..."),await d(),i.success("任务状态刷新成功")}catch(c){s(`刷新失败: ${c.message}`,"error"),i.error(`刷新失败: ${c.message}`)}},j=()=>a.selectedToken?{roleId:a.selectedToken.id}:null,oe=c=>{try{const t=localStorage.getItem(`daily-settings:${c}`);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load settings:",t),null}},le=(c,t)=>{try{localStorage.setItem(`daily-settings:${c}`,JSON.stringify(t))}catch(w){console.error("Failed to save settings:",w)}};return ee(f,c=>{const t=j();t&&le(t.roleId,c)},{deep:!0}),ee(()=>a.selectedToken,async(c,t)=>{if(c&&c!==t){s(`切换到Token: ${c.name}`);const w=oe(c.id);if(w&&Object.assign(f,w),P.value)try{await d()}catch(p){console.warn("切换token后获取角色信息失败:",p.message)}}},{immediate:!0}),ee(()=>a.selectedTokenRoleInfo,c=>{var t,w;(w=(t=c==null?void 0:c.role)==null?void 0:t.dailyTask)!=null&&w.complete&&(s("角色信息更新，同步任务状态"),n(c))},{immediate:!0,deep:!0}),de(async()=>{if(s("组件初始化完成"),a.selectedToken&&P.value)try{await d()}catch(t){console.warn("初始化时获取角色信息失败:",t.message)}const c=j();if(c){const t=oe(c.roleId);t&&Object.assign(f,t)}}),Ce(()=>{s("组件即将卸载")}),(c,t)=>{const w=F("n-icon"),p=F("n-progress"),R=F("n-select"),U=F("n-switch"),E=F("n-modal"),H=F("n-tag");return g(),_("div",Ht,[e("div",Nt,[t[16]||(t[16]=e("div",{class:"header-left"},[e("img",{src:At,alt:"每日任务",class:"task-icon"}),e("div",{class:"title-container"},[e("h3",null,"每日任务"),e("p",null,"当前进度")])],-1)),e("div",Rt,[e("div",{class:J(["status-indicator",{completed:C.value}]),onClick:t[0]||(t[0]=u=>o.value=!0)},[e("div",{class:J(["status-dot",{completed:C.value}])},null,2),t[15]||(t[15]=e("span",null,"任务详情",-1))],2),e("button",{class:"settings-button",onClick:t[1]||(t[1]=u=>r.value=!0)},[k(w,null,{default:D(()=>[k(L(ke))]),_:1})])])]),e("div",Pt,[k(p,{type:"line",percentage:T.value,height:8,"border-radius":4,color:O.value,"rail-color":"#f3f4f6"},null,8,["percentage","color"])]),t[32]||(t[32]=e("div",{class:"info-container"}," 右上角小齿轮有惊喜 ",-1)),e("button",{class:"execute-button",disabled:$.value||!P.value,onClick:q},[$.value?(g(),_("span",Lt,t[17]||(t[17]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 执行中... ",-1)]))):P.value?(g(),_("span",jt,"一键补差")):(g(),_("span",Gt,"WebSocket未连接"))],8,Vt),k(E,{show:r.value,"onUpdate:show":t[12]||(t[12]=u=>r.value=u),preset:"card",title:"任务设置",style:{width:"400px"}},{header:D(()=>[e("div",qt,[k(w,null,{default:D(()=>[k(L(ke))]),_:1}),t[18]||(t[18]=e("span",null,"任务设置",-1))])]),default:D(()=>[e("div",Jt,[e("div",Qt,[e("div",Xt,[t[19]||(t[19]=e("label",{class:"setting-label"},"竞技场阵容",-1)),k(R,{value:f.arenaFormation,"onUpdate:value":t[2]||(t[2]=u=>f.arenaFormation=u),options:L(Y),size:"small"},null,8,["value","options"])]),e("div",Yt,[t[20]||(t[20]=e("label",{class:"setting-label"},"BOSS阵容",-1)),k(R,{value:f.bossFormation,"onUpdate:value":t[3]||(t[3]=u=>f.bossFormation=u),options:L(Y),size:"small"},null,8,["value","options"])]),e("div",Kt,[t[21]||(t[21]=e("label",{class:"setting-label"},"BOSS次数",-1)),k(R,{value:f.bossTimes,"onUpdate:value":t[4]||(t[4]=u=>f.bossTimes=u),options:L(W),size:"small"},null,8,["value","options"])]),e("div",Zt,[e("div",Ft,[t[22]||(t[22]=e("span",{class:"switch-label"},"领罐子",-1)),k(U,{value:f.claimBottle,"onUpdate:value":t[5]||(t[5]=u=>f.claimBottle=u)},null,8,["value"])]),e("div",es,[t[23]||(t[23]=e("span",{class:"switch-label"},"领挂机",-1)),k(U,{value:f.claimHangUp,"onUpdate:value":t[6]||(t[6]=u=>f.claimHangUp=u)},null,8,["value"])]),e("div",ts,[t[24]||(t[24]=e("span",{class:"switch-label"},"竞技场",-1)),k(U,{value:f.arenaEnable,"onUpdate:value":t[7]||(t[7]=u=>f.arenaEnable=u)},null,8,["value"])]),e("div",ss,[t[25]||(t[25]=e("span",{class:"switch-label"},"开宝箱",-1)),k(U,{value:f.openBox,"onUpdate:value":t[8]||(t[8]=u=>f.openBox=u)},null,8,["value"])]),e("div",ns,[t[26]||(t[26]=e("span",{class:"switch-label"},"领取邮件奖励",-1)),k(U,{value:f.claimEmail,"onUpdate:value":t[9]||(t[9]=u=>f.claimEmail=u)},null,8,["value"])]),e("div",as,[t[27]||(t[27]=e("span",{class:"switch-label"},"黑市购买物品",-1)),k(U,{value:f.blackMarketPurchase,"onUpdate:value":t[10]||(t[10]=u=>f.blackMarketPurchase=u)},null,8,["value"])]),e("div",os,[t[28]||(t[28]=e("span",{class:"switch-label"},"付费招募",-1)),k(U,{value:f.payRecruit,"onUpdate:value":t[11]||(t[11]=u=>f.payRecruit=u)},null,8,["value"])])])])])]),_:1},8,["show"]),k(E,{show:o.value,"onUpdate:show":t[13]||(t[13]=u=>o.value=u),preset:"card",title:"每日任务详情",style:{width:"400px"}},{header:D(()=>[e("div",ls,[k(w,null,{default:D(()=>[k(L(He))]),_:1}),t[30]||(t[30]=e("span",null,"每日任务详情",-1)),e("button",{class:"refresh-button",disabled:$.value,onClick:te},[k(w,null,{default:D(()=>[k(L(Be))]),_:1}),t[29]||(t[29]=K(" 刷新状态 ",-1))],8,is)])]),default:D(()=>[e("div",rs,[(g(!0),_(ie,null,pe(z.value,u=>(g(),_("div",{key:u.id,class:"task-item"},[e("div",cs,[k(w,{class:J(["task-status-icon",{completed:u.completed}])},{default:D(()=>[u.completed?(g(),ve(L(Ve),{key:0})):(g(),ve(L(ct),{key:1}))]),_:2},1032,["class"]),e("span",us,x(u.name),1)]),k(H,{type:u.completed?"success":"default",size:"small"},{default:D(()=>[K(x(u.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]),_:1},8,["show"]),k(E,{show:A.value,"onUpdate:show":t[14]||(t[14]=u=>A.value=u),preset:"card",title:"任务执行日志",style:{width:"500px"}},{header:D(()=>[e("div",ds,[k(w,null,{default:D(()=>[k(L(ot))]),_:1}),t[31]||(t[31]=e("span",null,"任务执行日志",-1))])]),default:D(()=>[e("div",{ref_key:"logContainer",ref:S,class:"log-container"},[(g(!0),_(ie,null,pe(l.value,u=>(g(),_("div",{key:u.time+u.message,class:"log-item"},[e("span",ms,x(u.time),1),e("span",{class:J(["log-message",{error:u.type==="error",success:u.type==="success",warning:u.type==="warning"}])},x(u.message),3)]))),128))],512)]),_:1},8,["show"])])}}},vs=me(ps,[["__scopeId","data-v-887c3f6e"]]),gs={class:"tower-status-card"},fs={class:"card-header"},_s={class:"energy-display"},hs={class:"energy-count"},ys={class:"card-content"},ks={class:"tower-floor"},ws={class:"floor-number"},Ts={class:"card-actions"},bs=["disabled"],$s={__name:"TowerStatus",setup(Q){const a=ce(),i=ue(),r=B(!1),o=B(null);B(null);const A=M(()=>{var T;return((T=a.gameData)==null?void 0:T.roleInfo)||null}),$=M(()=>{var P,l;const h=(l=(P=A.value)==null?void 0:P.role)==null?void 0:l.tower;if(!h||!h.id&&h.id!==0)return"0 - 0";const T=h.id,C=Math.floor(T/10)+1,O=T%10+1;return`${C} - ${O}`}),S=M(()=>{var C,O;const h=(O=(C=A.value)==null?void 0:C.role)==null?void 0:O.tower;return(h==null?void 0:h.energy)||0}),f=M(()=>{const h=S.value>0,T=!r.value;return h&&T}),z=async()=>{if(!a.selectedToken){i.warning("请先选择Token");return}if(!f.value){i.warning("体力不足或正在爬塔中");return}o.value&&(clearTimeout(o.value),o.value=null),r.value=!0,o.value=setTimeout(()=>{r.value=!1,o.value=null},15e3);try{const h=a.selectedToken.id;await a.sendMessageWithPromise(h,"fight_starttower",{},1e4),i.success("爬塔命令已发送"),await W(),setTimeout(async()=>{await W(),o.value&&(clearTimeout(o.value),o.value=null),r.value=!1},2e3)}catch(h){i.error("爬塔失败: "+(h.message||"未知错误")),o.value&&(clearTimeout(o.value),o.value=null),r.value=!1}},Y=()=>{o.value&&(clearTimeout(o.value),o.value=null),r.value=!1,i.info("爬塔状态已重置")},W=async()=>{if(!a.selectedToken){console.warn("🗼 getTowerInfo: 没有选中的Token");return}try{const h=a.selectedToken.id;if(a.getWebSocketStatus(h)!=="connected")return;const C=a.sendMessage(h,"role_getroleinfo"),O=a.sendMessage(h,"tower_getinfo");!C&&!O&&console.error("🗼 getTowerInfo: 所有请求都失败了")}catch(h){console.error("🗼 getTowerInfo: 获取塔信息失败:",h)}},G=M(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id):"disconnected");return ee(G,(h,T)=>{console.log(`🗼 WebSocket状态变化: ${T} -> ${h}`),h==="connected"&&T!=="connected"&&(console.log("🗼 WebSocket已连接，自动获取塔信息"),setTimeout(()=>{W()},1e3))}),ee(()=>a.selectedToken,(h,T)=>{h&&h.id!==(T==null?void 0:T.id)&&(console.log("🗼 Token已切换，获取新的塔信息"),a.getWebSocketStatus(h.id)==="connected"&&W())}),ee(()=>a.gameData.towerResult,(h,T)=>{h&&h.timestamp!==(T==null?void 0:T.timestamp)&&(console.log("🗼 收到新的爬塔结果:",h),h.success?(i.success("咸将塔挑战成功！"),h.autoReward&&setTimeout(()=>{i.success(`自动领取第${h.rewardFloor}层奖励`)},1e3)):i.error("咸将塔挑战失败"),setTimeout(()=>{console.log("🗼 爬塔结果处理完成，重置状态"),o.value&&(clearTimeout(o.value),o.value=null),r.value=!1},2e3))},{deep:!0}),de(()=>{a.selectedToken&&a.getWebSocketClient(a.selectedToken.id),a.selectedToken&&G.value==="connected"?W():a.selectedToken?console.log("🗼 WebSocket未连接，等待连接后自动获取塔信息"):console.log("🗼 没有选中的Token，无法获取塔信息")}),(h,T)=>(g(),_("div",gs,[e("div",fs,[T[1]||(T[1]=e("div",{class:"header-info"},[e("img",{src:be,alt:"爬塔图标",class:"tower-icon"}),e("div",{class:"tower-info"},[e("h3",null,"咸将塔"),e("p",null,"一个不小心就过了")])],-1)),e("div",_s,[T[0]||(T[0]=e("img",{src:Ue,alt:"小鱼干",class:"energy-icon"},null,-1)),e("span",hs,x(S.value),1)])]),e("div",ys,[e("div",ks,[T[2]||(T[2]=e("span",{class:"label"},"当前层数",-1)),e("span",ws,x($.value),1)])]),e("div",Ts,[e("button",{class:J(["climb-button",{active:f.value,disabled:!f.value}]),disabled:!f.value,onClick:z},x(r.value.value?"爬塔中...":"开始爬塔"),11,bs),r.value.value?(g(),_("button",{key:0,class:"reset-button",onClick:Y}," 重置状态 ")):re("",!0)])]))}},Ss=me($s,[["__scopeId","data-v-23f2c101"]]),xs={class:"game-status-container"},Cs={class:"status-card bottle-helper"},Is={class:"card-header"},Ms={class:"card-content"},Ds={class:"time-display"},Bs={class:"status-card hang-up"},Us={class:"card-header"},zs={class:"status-info"},Ws={class:"card-content"},Os={class:"time-display"},Es={class:"action-row"},As=["disabled"],Hs={key:0,class:"loading-text"},Ns={key:1},Rs=["disabled"],Ps={key:0,class:"loading-text"},Vs={key:1},Ls={class:"status-card legion-signin"},Gs={class:"card-header"},js={class:"card-content"},qs={key:0,class:"club-name"},Js={key:1,class:"description"},Qs=["disabled"],Xs={class:"status-card study"},Ys={class:"card-header"},Ks={class:"card-content"},Zs=["disabled"],Fs={key:0},en={key:1,class:"loading-text"},tn={key:0},sn={key:1},nn={key:2},an={key:3},on={key:4},ln={key:2},rn={__name:"GameStatus",setup(Q){const a=ce(),i=ue(),r=B({isRunning:!1,remainingTime:0,stopTime:0}),o=B({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),A=B({isRegistered:!1}),$=B({isSignedIn:!1,clubName:""}),S=M(()=>a.gameData.studyStatus),f=M(()=>{var l;return((l=a.gameData)==null?void 0:l.roleInfo)||null}),z=l=>{const s=Math.floor(Number(l)||0);if(s<=0)return"00:00:00";const n=Math.floor(s/3600),d=Math.floor(s%3600/60),m=s%60;return`${n.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},Y=()=>{if(!f.value)return;const l=f.value.role;if(l.bottleHelpers){const s=Date.now()/1e3;r.value.stopTime=l.bottleHelpers.helperStopTime,r.value.isRunning=l.bottleHelpers.helperStopTime>s,r.value.remainingTime=Math.max(0,Math.floor(l.bottleHelpers.helperStopTime-s)),console.log("🤖 盐罐机器人状态更新:",{stopTime:l.bottleHelpers.helperStopTime,now:s,remainingTime:r.value.remainingTime,isRunning:r.value.isRunning})}if(l.hangUp){const s=Date.now()/1e3;o.value.lastTime=l.hangUp.lastTime,o.value.hangUpTime=l.hangUp.hangUpTime;const n=s-o.value.lastTime;n<=o.value.hangUpTime?(o.value.remainingTime=Math.floor(o.value.hangUpTime-n),o.value.isActive=!0):(o.value.remainingTime=0,o.value.isActive=!1),o.value.elapsedTime=Math.floor(o.value.hangUpTime-o.value.remainingTime),console.log("⏰ 挂机状态更新:",{lastTime:o.value.lastTime,hangUpTime:o.value.hangUpTime,elapsed:n,remainingTime:o.value.remainingTime,elapsedTime:o.value.elapsedTime,isActive:o.value.isActive})}if(l.statistics){const s=new Date;s.setHours(0,0,0,0);const n=s.getTime()/1e3;A.value.isRegistered=Number(l.statistics["last:legion:match:sign:up:time"])>n}if(l.statisticsTime){const s=new Date;s.setHours(0,0,0,0);const n=s.getTime()/1e3;$.value.isSignedIn=l.statisticsTime["legion:sign:in"]>n}};let W=null;const G=()=>{W&&clearInterval(W),W=setInterval(()=>{r.value.isRunning&&r.value.remainingTime>0&&(r.value.remainingTime=Math.max(0,r.value.remainingTime-1),r.value.remainingTime<=0&&(r.value.isRunning=!1)),o.value.isActive&&o.value.remainingTime>0&&(o.value.remainingTime=Math.max(0,o.value.remainingTime-1),o.value.elapsedTime=o.value.elapsedTime+1,o.value.remainingTime<=0&&(o.value.isActive=!1))},1e3)},h=()=>{if(!a.selectedToken){i.warning("请先选择Token");return}const l=a.selectedToken.id;a.sendMessage(l,"bottlehelper_stop"),setTimeout(()=>{a.sendMessage(l,"bottlehelper_start"),a.sendMessage(l,"role_getroleinfo")},500),i.info(r.value.isRunning?"重启盐罐机器人":"启动盐罐机器人")},T=async()=>{if(!a.selectedToken){i.warning("请先选择Token");return}const l=a.selectedToken.id;try{console.log("🕐 开始加钟操作..."),o.value.isExtending=!0,i.info("正在加钟...");const s=[];for(let n=0;n<4;n++){const d=new Promise(m=>{setTimeout(()=>{console.log(`🕐 发送第${n+1}次加钟请求`);const y=a.sendMessage(l,"system_mysharecallback",{isSkipShareCard:!0,type:2});m(y)},n*300)});s.push(d)}await Promise.all(s),console.log("🕐 所有加钟请求已发送"),setTimeout(()=>{console.log("🕐 加钟后获取最新角色信息"),a.sendMessage(l,"role_getroleinfo")},1500),setTimeout(()=>{i.success("加钟操作已完成，请查看挂机剩余时间"),o.value.isExtending=!1},2500)}catch(s){console.error("🕐 加钟操作失败:",s),i.error("加钟操作失败: "+(s.message||"未知错误")),o.value.isExtending=!1}},C=async()=>{if(!a.selectedToken){i.warning("请先选择Token");return}const l=a.selectedToken.id;try{console.log("🎁 开始领取挂机奖励..."),o.value.isClaiming=!0,i.info("正在领取挂机奖励..."),a.sendMessage(l,"system_mysharecallback"),setTimeout(()=>{a.sendMessage(l,"system_claimhangupreward")},200),setTimeout(()=>{a.sendMessage(l,"system_mysharecallback",{isSkipShareCard:!0,type:2})},400),setTimeout(()=>{a.sendMessage(l,"role_getroleinfo")},600),setTimeout(()=>{i.success("挂机奖励领取完成"),o.value.isClaiming=!1},1200),console.log("🎁 挂机奖励领取操作序列已启动")}catch(s){console.error("🎁 领取挂机奖励失败:",s),i.error("领取挂机奖励失败: "+(s.message||"未知错误")),o.value.isClaiming=!1}},O=()=>{if(!a.selectedToken||$.value.isSignedIn)return;const l=a.selectedToken.id;a.sendMessage(l,"legion_signin"),a.sendMessage(l,"role_getroleinfo"),i.info("俱乐部签到")},P=async()=>{if(!(!a.selectedToken||S.value.isAnswering)){if(S.value.isCompleted){i.success("✅ 咸鱼大冲关任务已完成，无需重复作答！");return}try{await ye();const l=await Me();a.gameData.studyStatus={...a.gameData.studyStatus,isAnswering:!0,questionCount:0,answeredCount:0,status:"starting",timestamp:Date.now()};const s=a.selectedToken.id;a.sendMessage(s,"study_startgame"),setTimeout(()=>{a.gameData.studyStatus.isAnswering&&(a.gameData.studyStatus={...a.gameData.studyStatus,isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},i.warning("答题超时，已自动重置状态"))},3e4),i.info(`🚀 开始一键答题... (题库包含 ${l} 道题目)`)}catch(l){console.error("启动答题失败:",l),i.error("启动答题失败: "+l.message)}}};return ee(f,l=>{l&&Y()},{deep:!0,immediate:!0}),de(()=>{if(Y(),G(),ye().then(()=>{console.log("📚 答题数据预加载完成")}).catch(l=>{console.error("❌ 答题数据预加载失败:",l)}),a.selectedToken){const l=a.selectedToken.id;a.sendMessage(l,"legion_getinfo")}}),Te(()=>{W&&clearInterval(W)}),(l,s)=>(g(),_("div",xs,[k(Et),k(vs),k(Ss),e("div",Cs,[e("div",Is,[s[1]||(s[1]=e("img",{src:vt,alt:"盐罐图标",class:"status-icon"},null,-1)),s[2]||(s[2]=e("div",{class:"status-info"},[e("h3",null,"盐罐机器人"),e("p",null,"剩余时间")],-1)),e("div",{class:J(["status-badge",{active:r.value.isRunning}])},[s[0]||(s[0]=e("div",{class:"status-dot"},null,-1)),e("span",null,x(r.value.isRunning?"运行中":"已停止"),1)],2)]),e("div",Ms,[e("div",Ds,x(z(r.value.remainingTime)),1),e("button",{class:"action-button",onClick:h},x(r.value.isRunning?"重启服务":"启动服务"),1)])]),e("div",Bs,[e("div",Us,[s[5]||(s[5]=e("img",{src:gt,alt:"挂机图标",class:"status-icon"},null,-1)),e("div",zs,[s[3]||(s[3]=e("h3",null,"挂机时间",-1)),e("p",null,"已挂机："+x(z(o.value.elapsedTime)),1)]),e("div",{class:J(["status-badge",{active:o.value.isActive}])},[s[4]||(s[4]=e("div",{class:"status-dot"},null,-1)),e("span",null,x(o.value.isActive?"挂机中":"已完成"),1)],2)]),e("div",Ws,[e("div",Os,x(z(o.value.remainingTime)),1),e("div",Es,[e("button",{class:"action-button secondary",disabled:o.value.isExtending,onClick:T},[o.value.isExtending?(g(),_("span",Hs,s[6]||(s[6]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 加钟中... ",-1)]))):(g(),_("span",Ns,"加钟"))],8,As),e("button",{class:"action-button primary",disabled:o.value.isClaiming,onClick:C},[o.value.isClaiming?(g(),_("span",Ps,s[7]||(s[7]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 领取中... ",-1)]))):(g(),_("span",Vs,"领取奖励"))],8,Rs)])])]),e("div",Ls,[e("div",Gs,[s[9]||(s[9]=e("img",{src:be,alt:"签到图标",class:"status-icon"},null,-1)),s[10]||(s[10]=e("div",{class:"status-info"},[e("h3",null,"俱乐部签到"),e("p",null,"每日签到状态")],-1)),e("div",{class:J(["status-badge",{active:$.value.isSignedIn}])},[s[8]||(s[8]=e("div",{class:"status-dot"},null,-1)),e("span",null,x($.value.isSignedIn?"已签到":"待签到"),1)],2)]),e("div",js,[$.value.clubName?(g(),_("p",qs,[s[11]||(s[11]=K(" 当前俱乐部",-1)),s[12]||(s[12]=e("br",null,null,-1)),e("strong",null,x($.value.clubName),1)])):(g(),_("p",Js," 尚未加入任何俱乐部 ")),e("button",{class:"action-button",disabled:$.value.isSignedIn,onClick:O},x($.value.isSignedIn?"已签到":"立即签到"),9,Qs)])]),e("div",Xs,[e("div",Ys,[s[14]||(s[14]=e("img",{src:ft,alt:"学习图标",class:"status-icon"},null,-1)),s[15]||(s[15]=e("div",{class:"status-info"},[e("h3",null,"咸鱼大冲关"),e("p",null,"每日知识挑战")],-1)),e("div",{class:J(["status-badge weekly",{completed:S.value.isCompleted}])},[e("div",{class:J(["status-dot",{completed:S.value.isCompleted}])},null,2),s[13]||(s[13]=e("span",null,"每周任务",-1))],2)]),e("div",Ks,[s[17]||(s[17]=e("p",{class:"description"}," 没有什么可以阻挡我求知的欲望！ ",-1)),e("button",{class:J(["action-button",{completed:S.value.isCompleted}]),disabled:S.value.isAnswering||S.value.isCompleted,onClick:P},[S.value.isCompleted?(g(),_("span",Fs," ✅ 已完成无需作答 ")):S.value.isAnswering?(g(),_("span",en,[s[16]||(s[16]=e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1)),S.value.status==="starting"?(g(),_("span",tn,"正在获取题目...")):S.value.status==="answering"?(g(),_("span",sn,"答题中 "+x(S.value.answeredCount)+"/"+x(S.value.questionCount),1)):S.value.status==="claiming_rewards"?(g(),_("span",nn,"正在领取奖励...")):S.value.status==="completed"?(g(),_("span",an,"答题完成")):(g(),_("span",on,"答题中..."))])):(g(),_("span",ln,"🎯 一键答题"))],10,Zs)])])]))}},cn=me(rn,[["__scopeId","data-v-d084b52b"]]),un={class:"game-features-page"},dn={class:"page-header"},mn={class:"container"},pn={class:"header-content"},vn={class:"header-left flex items-center"},gn={class:"page-subtitle"},fn={class:"header-actions flex items-center"},_n={key:0,class:"feedback-section"},hn={class:"features-grid-section"},yn={class:"container"},kn={__name:"GameFeatures",setup(Q){var s;const a=De(),i=ue(),r=ce(),{isMobile:o}=ze(),A=B(!1),$=B(((s=r.selectedToken)==null?void 0:s.id)||null),S=M(()=>r.gameTokens.map(n=>({label:n.name,value:n.id}))),f=M(()=>{const n=r.gameTokens.find(d=>d.id===$.value);return(n==null?void 0:n.name)||"未选择Token"}),z=B(!1),Y=n=>z.value=n,W=n=>{r.selectToken(n),C(),i.success(`已切换到Token: ${f.value}`)},G=M(()=>r.selectedToken&&r.getWebSocketStatus(r.selectedToken.id)==="connected"?"connected":"disconnected"),h=M(()=>r.selectedToken?r.getWebSocketStatus(r.selectedToken.id)==="connected"?"已连接":"未连接":"未选择Token");M(()=>G.value==="connected"?"status-connected":"status-disconnected");const T=M(()=>G.value==="connected"),C=()=>{if(!r.selectedToken){i.warning("请先选择一个Token"),a.push("/tokens");return}try{A.value=!0;const n=r.selectedToken.id,d=r.selectedToken.token;r.createWebSocketConnection(n,d),i.info("正在建立 WebSocket 连接..."),setTimeout(async()=>{r.getWebSocketStatus(n)==="connected"&&(i.success("WebSocket 连接成功"),await l(),A.value=!1)},2e3)}catch(n){console.error("WebSocket连接失败:",n),i.error("WebSocket连接失败")}},O=()=>{if(r.selectedToken){const n=r.selectedToken.id;r.closeWebSocketConnection(n),i.info("WebSocket连接已断开")}},P=()=>{G.value==="connected"?O():C()};de(()=>{r.selectedToken&&(r.getWebSocketStatus(r.selectedToken.id)!=="connected"?C():l())});const l=async()=>{if(r.selectedToken)try{const n=r.selectedToken.id;console.log("🎮 初始化游戏数据..."),console.log("🎮 正在获取角色信息...");const d=r.sendMessage(n,"role_getroleinfo");console.log("🎮 角色信息请求结果:",d),console.log("🎮 正在获取塔信息...");const m=r.sendMessage(n,"tower_getinfo");console.log("🎮 塔信息请求结果:",m),console.log("🎮 正在获取队伍信息...");const y=r.sendMessage(n,"presetteam_getinfo");console.log("🎮 队伍信息请求结果:",y),console.log("🎮 游戏数据初始化请求已发送")}catch(n){console.warn("初始化游戏数据失败:",n)}};return Te(()=>{}),(n,d)=>{const m=F("n-icon"),y=F("n-button"),I=F("n-popselect"),N=F("n-spin");return g(),_("div",un,[k(N,{show:A.value},{default:D(()=>[e("div",dn,[e("div",mn,[e("div",pn,[e("div",vn,[d[2]||(d[2]=e("h1",{class:"page-title mr-20px"},"游戏功能",-1)),e("div",gn,[k(I,{value:$.value,"onUpdate:value":[d[0]||(d[0]=ae=>$.value=ae),W],options:S.value,trigger:"click","onUpdate:show":Y},{default:D(()=>[k(y,{text:"","icon-placement":"right",type:"primary",size:"large"},{icon:D(()=>[z.value?(g(),ve(m,{key:0},{default:D(()=>[k(L(Ye))]),_:1})):(g(),ve(m,{key:1},{default:D(()=>[k(L(qe))]),_:1}))]),default:D(()=>[K(x(f.value||"未选择Token")+" ",1)]),_:1})]),_:1},8,["value","options"])])]),e("div",fn,[e("div",{class:J(["connection-status mr-20px",G.value])},[k(m,null,{default:D(()=>[k(L(et))]),_:1}),e("span",null,x(h.value),1)],2),k(y,{text:"",onClick:P},{default:D(()=>[K(x(T.value?"断开连接":"重新连接"),1)]),_:1}),k(y,{style:{"margin-left":"40px"},text:"",onClick:d[1]||(d[1]=ae=>L(a).back())},{default:D(()=>d[3]||(d[3]=[K("返回Token管理",-1)])),_:1,__:[3]})])])])]),L(o)?re("",!0):(g(),_("div",_n)),e("div",hn,[e("div",yn,[k(cn)])])]),_:1},8,["show"])])}}},$n=me(kn,[["__scopeId","data-v-c816b1cf"]]);export{$n as default};
